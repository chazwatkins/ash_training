# Lab 10 - AshGraphql

## Relevant Documentation

- [AshGraphql Docs](https://hexdocs.pm/ash_graphql/getting-started-with-graphql.html)

## Existing Setup

- Added to router, including playground

## Steps

1. Uncomment the contents of `TwitterWeb.GraphqlSchema` in `lib/twitter_web/graphql_schema.ex`.

2. Add `AshGraphql.Resource` to the extensions

```bash
mix ash.patch.extend Twitter.Tweets.Tweet graphql
```

3. Add a `query` to get the `:feed`

```elixir
graphql do
  type :tweet
end
```

4. Add the extension and a `query` to the `Twitter.Tweets`.

```elixir
use Ash.Domain,
  extension: [AshGraphql.Domain]

graphql do
  queries do
    list :feed, :feed
    list Twitter.Tweets.Tweet, :feed, :feed
  end
end
```

5. Go to `localhost:4000/api/gql/playground`, and try the following query.
Make sure that all fields referenced below have been made `public? true`.

```graphql
query {
  feed {
    id
    text
    likeCount
    userEmail
  }
}
```

Browse the schema to see the kinds of things you can do, like filtering and sorting.

For example:

```graphql
query {
  feed(filter: { likeCount: { greaterThan: 0 } }) {
    id
    text
    likeCount
    userEmail
  }
}
```

## Try on your own

- Try out filtering/sorting in the GraphQL Playground

- Expose additional fields on the `:tweet` type

- Expose the `like` action over the GraphQL API, using the `mutations` configuration

- Expose the `unlike` action as well. (hint: you'll need to use `identity false` on the mutation)

You may have done the following already.

- Add a `description` to one of the attributes to see how it populates in the autogenerated documentation.
- Add a `description` to the action, and to the resource as well.

**_TIP_**: For resources, the `description` is added inside of the `resource` block.

```elixir
resource do
  description "your_description"
end
```
